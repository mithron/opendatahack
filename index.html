<html>
<head>
	<title>Московские школы</title>
	<meta charset="utf-8">
	
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>	

    <link rel="stylesheet" href="leaflet-dvf/dist/css/dvf.css" type="text/css" />
    <script type="text/javascript" src="leaflet-dvf/dist/leaflet-dvf.min.js"></script>
    <script type="text/javascript" src="leaflet-dvf/src/leaflet.dvf.experimental.js"></script>

    <link rel="stylesheet" href="Leaflet.StyledLayerControl/css/styledLayerControl.css" />
    <script src="Leaflet.StyledLayerControl//src/styledLayerControl.js"></script>
	
	<script src="leaflet-sidebar/src/L.Control.Sidebar.js"></script>
	<link rel="stylesheet" href="leaflet-sidebar/src/L.Control.Sidebar.css" />
	
	<link rel="stylesheet" href="Leaflet.loading/src/Control.Loading.css" />
    <script src="Leaflet.loading/src/Control.Loading.js"></script>
	
	<script src="spin.min.js"></script>
	
</head>
<body>
	<div id="hidden"><audio src="http://tts.voicetech.yandex.net/generate?text='Наш%20текст%20гот%2bов'&format=mp3&lang=ru-RU&speaker=zahar&key=519d3768-9302-4f28-8eab-0eb1bf9579d5" autoplay="autoplay" type="audio/mp3" preload="none"></audio></div>
	
	<div id="sidebar">
		<h1>Здравствуйте!</h1>		
		<p>Перед вами - справочник по расходам московских школ. Здесь представлены расходы лучших школ Москвы - тех школ, которые входили хотя бы раз в тот список, что выпускается ежегожно Департаментом Образования Москвы. </p>
		<p>Пока что загружаются данные - немного об этом инструменте. </p>
		<p>В правой панели Вы можете выбрать те школы, которые вас интересуют. Они будут представлены на карте. У выбранных школ будет отображена круговая диаграмма расходов. На диаграмме пропорционально сумме отображены контакты, при наведении мышки на них во всплывающем окне показана сумма и поставщик. </p>
		<p>Школы линиями соединены с поставщиками. Толщина линии пропорциональна сумме контракта. Если кликнуть линию, то будет показано местоположение поставщика и его название. 
		</p>
		<p>Цвет индивидуально идентифицирует поставщика. Цвет на круговой диаграмме и линии совпадает.</p>		
	</div>
	<div id="map"></div>
	
	<script defer="defer" src="schools_data_short.js"></script>
    <script defer="defer" src="contdata3.js"></script>
	<script defer="defer" src="main.js"></script>
	
	<script>
	var map;

	var resize = function () {
		var $map = $('#map');

		$map.height($(window).height() - $('div.navbar').outerHeight());

		if (map) {
			map.invalidateSize();
		}
	};

	$(window).on('resize', function () {
		resize();
	});

	resize();

	map = L.map('map').setView([55.75, 37.63], 10);
	
	var accessToken = 'pk.eyJ1IjoibWl0aHJvbiIsImEiOiJiT0wwZkMwIn0.MnqefBaviEHMB3li6tpL4g';
	var mapboxTiles = L.tileLayer('https://{s}.tiles.mapbox.com/v4/mithron.lake28fh/{z}/{x}/{y}.png?access_token=' + accessToken, { maxZoom: 18, 
				attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
				}).addTo(map);	

        // Add a layer control
    var base = [];
    var over = [];
    var layerControl = L.Control.styledLayerControl(base, over, { collapsed:false, container_width: "200px",
            container_maxHeight: "550px",  group_maxHeight: "550px", exclusive: false}).addTo(map);
		 
	var loadingControl = L.Control.loading({
            separate: true, spinjs:true, 
			spin: { lines: 15, length: 5, width: 5, radius: 4, corners: 1, rotate: 13,
			direction: 1, color: '#000', speed: 1, trail: 60, shadow: false, hwaccel: false, 
			zIndex: 2e9, top: '50%', left: '50%' 
			}
                });
    map.addControl(loadingControl);
	map.fire("dataloading");
	
	var sidebar = L.control.sidebar('sidebar', {
            closeButton: true,
            position: 'left'
       });
    map.addControl(sidebar);
    setTimeout(function () {
            sidebar.show();
        }, 50);	
	</script>
</body></html>
